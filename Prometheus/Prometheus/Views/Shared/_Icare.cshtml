<button type="button" class="btn btn-warning" id="i_care" name="i_care" data-ikey="@(Model.IssueKey)" data-pkey="@(Model.ProjectKey)" >ICare</button>
<script>
    $(function () {
        var ikey = '@Model.IssueKey';
        var pkey = '@Model.ProjectKey';
        $.post('/Issue/GetICare',
        {
            pkey: pkey,
            ikey: ikey
        }, function(output){
            if(output.success){
                $('#i_care').html('Cancel ICare');
                $('#i_care').attr('id', 'cancel_icare')
            }
        });
    })
    $('body').on('click', '#cancel_icare', function(){
        var ikey = $(this).attr('data-ikey');
        var pkey = $(this).attr('data-pkey');
        $.post('/Issue/CancelICare',
        {
            pkey: pkey,
            ikey: ikey
        }, function (output) {
            if (output.success) {
                window.location.reload();
            }
            else {
                alert("Failed to cancel ICare!");
            }
        })
    })
    $('body').on('click', '#i_care', function () {
        var ikey = $(this).attr('data-ikey');
        var pkey = $(this).attr('data-pkey');
        $.post('/Issue/ICare',
        {
            pkey: pkey,
            ikey: ikey
        }, function (output) {
            if (output.success) {
                window.location.reload();
            }
            else {
                alert("Failed to ICare!");
            }
        })
    })
</script>
